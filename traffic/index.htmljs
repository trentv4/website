<!DOCTYPE html>
<html>
	<head>
		<title>Site Traffic</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link id="style" rel="stylesheet" type="text/css" href="/global/stylesheet.less">
		<link id="style" rel="stylesheet" type="text/css" href="stylesheet.less">
	</head>

	<body>
		<% document.require("global/header.htmljs") %>
		<div id="page">
			<div id="credentials">
				<p>Username: </p>
				<textarea id="un"></textarea>
				<p>Password: </p>
				<input type="password" id="pw"></textarea>
			</div>
			<table>
			<th>Page</th>
			<th>Hits</th>
			<th>State</th>
			<th>Commands</th>
			<%
			let data = sql.querySync("select * from traffic order by hits desc")
			for(let i = 0; i < data.length; i++) {
				document.write("<tr>")
				document.write("<td class='page-entry'><a href='"+ data[i].page +"'>"+ data[i].page +"</a></td>")
				document.write("<td>" + data[i].hits + "</td>")
				document.write("<td>" + data[i].state + "</td>")
				
				document.write("<td>")
				document.write(`<a href="" onclick='send("/api/traffic/forbid/", "`+escape(data[i].page)+`")'>[forbid]</a>`)
				document.write(`<a href="" onclick='send("/api/traffic/delete/", "`+escape(data[i].page)+`")'>[delete]</a>`)
				document.write(`<a href="" onclick='send("/api/traffic/allow/", "`+escape(data[i].page)+`")'>[allow]</a>`)
				document.write("</td>")
				
				document.write("</tr>")
			}
			%>
			</table>
		</div>
		<script src="main.js" type="text/javascript"></script>
		<% document.require("global/footer.htmljs") %>
	</body>
</html>
